# 简易工单管理系统 (Simple Ticket Management System) 需求与设计文档

## 1. 项目概述

本项目旨在构建一个轻量级的、本地部署的工单（Ticket）管理工具。用户可以通过该工具创建、追踪和分类管理日常任务或问题。系统强调简单易用，支持通过标签（Tag）对工单进行灵活分类，并提供搜索和状态管理功能。

## 2. 技术栈

*   **数据库**: MySQL
*   **后端**: FastAPI (Python)
*   **前端**: TypeScript + Vite + React (推断) + Tailwind CSS + Shadcn UI
*   **部署**: 本地部署 (Localhost)

## 3. 功能需求

### 3.1 工单管理 (Ticket Management)
*   **创建工单**: 用户可以创建一个新的工单，包含标题（Title）和描述（Description）。
*   **编辑工单**: 用户可以修改现有工单的标题和描述。
*   **删除工单**: 用户可以永久删除一个工单。
*   **状态管理**:
    *   **完成工单**: 将工单状态标记为“已完成”。
    *   **取消完成**: 将工单状态恢复为“未完成”或“进行中”。
*   **查看列表**: 展示所有工单的列表，支持分页（可选）或无限滚动。
*   **查看详情**: 点击工单可查看其完整详细信息。

### 3.2 标签管理 (Tag Management)
*   **添加标签**: 在创建或编辑工单时，可以为工单添加一个或多个标签。
*   **移除标签**: 可以从工单中移除已关联的标签。
*   **标签筛选**: 用户可以点击某个标签，筛选出所有包含该标签的工单。

### 3.3 搜索与过滤 (Search & Filter)
*   **按标题搜索**: 提供搜索框，支持根据工单标题进行模糊搜索。
*   **按状态过滤**: (可选) 筛选“已完成”或“未完成”的工单。

### 3.4 用户系统
*   **无用户系统**: 系统运行在本地，默认为单用户模式，无需登录注册。

## 4. 数据库设计 (Schema)

### 4.1 表结构

#### `tickets` 表
| 字段名 | 类型 | 描述 | 约束 |
| :--- | :--- | :--- | :--- |
| `id` | INT / BIGINT | 工单唯一标识 | Primary Key, Auto Increment |
| `title` | VARCHAR(255) | 工单标题 | Not Null |
| `description` | TEXT | 工单详情描述 | Nullable |
| `status` | ENUM('open', 'closed') | 工单状态 | Default 'open' |
| `created_at` | DATETIME | 创建时间 | Default Current Timestamp |
| `updated_at` | DATETIME | 更新时间 | Default Current Timestamp, On Update Current Timestamp |

#### `tags` 表
| 字段名 | 类型 | 描述 | 约束 |
| :--- | :--- | :--- | :--- |
| `id` | INT / BIGINT | 标签唯一标识 | Primary Key, Auto Increment |
| `name` | VARCHAR(50) | 标签名称 | Not Null, Unique |
| `color` | VARCHAR(20) | 标签颜色 (Hex) | Optional, Default '#000000' |

#### `ticket_tags` 表 (关联表)
| 字段名 | 类型 | 描述 | 约束 |
| :--- | :--- | :--- | :--- |
| `ticket_id` | INT / BIGINT | 工单ID | Foreign Key -> tickets.id, On Delete Cascade |
| `tag_id` | INT / BIGINT | 标签ID | Foreign Key -> tags.id, On Delete Cascade |
| PRIMARY KEY | (ticket_id, tag_id) | 复合主键 | |

## 5. API 接口设计 (RESTful)

### 5.1 工单 (Tickets)

*   `GET /api/tickets`
    *   查询参数:
        *   `search`: string (可选，按标题搜索)
        *   `tag_id`: int (可选，按标签筛选)
        *   `status`: string (可选，open/closed)
    *   响应: 工单列表 JSON

*   `POST /api/tickets`
    *   请求体: `{ "title": "...", "description": "..." }`
    *   响应: 创建的工单对象

*   `GET /api/tickets/{id}`
    *   响应: 单个工单详情（包含标签信息）

*   `PUT /api/tickets/{id}`
    *   请求体: `{ "title": "...", "description": "...", "status": "..." }`
    *   响应: 更新后的工单对象

*   `DELETE /api/tickets/{id}`
    *   响应: 204 No Content

### 5.2 标签 (Tags) & 关联

*   `GET /api/tags`
    *   响应: 所有可用标签列表

*   `POST /api/tags`
    *   请求体: `{ "name": "..." }`
    *   说明: 创建新标签（通常在给工单打标签时如果标签不存在则自动创建，或者独立管理）

*   `POST /api/tickets/{id}/tags`
    *   请求体: `{ "tag_id": ... }` 或 `{ "tag_name": "..." }`
    *   说明: 给指定工单添加标签

*   `DELETE /api/tickets/{id}/tags/{tag_id}`
    *   说明: 移除指定工单的某个标签

## 6. 前端设计

### 6.1 页面结构
*   **首页 (Dashboard)**:
    *   顶部: 搜索栏、创建工单按钮。
    *   左侧/顶部: 标签过滤器列表 (Tags Cloud/List)。
    *   主体: 工单卡片列表 (Ticket List)。
        *   每个卡片显示: 标题、摘要、状态图标、标签集合、操作按钮 (编辑/删除/完成)。
*   **创建/编辑模态框 (Modal)**:
    *   表单: 标题输入框、描述文本域、标签选择器 (支持输入新标签)。
*   **详情页 (可选)**:
    *   如果内容较多，可单独跳转详情页，或使用侧边抽屉 (Drawer) 展示。

### 6.2 UI 组件 (Shadcn UI)
*   `Card`: 用于展示工单项。
*   `Badge`: 用于展示标签和状态。
*   `Button`: 操作按钮。
*   `Input` / `Textarea`: 表单输入。
*   `Dialog` / `Sheet`: 用于创建和编辑工单。
*   `Select` / `Combobox`: 用于选择标签。

## 7. 开发计划建议

1.  **环境准备**: 初始化 MySQL 数据库，搭建 FastAPI 后端脚手架，初始化 Vite React 项目。
2.  **后端开发**:
    *   定义 SQLAlchemy 模型 (Models)。
    *   配置 Pydantic Schemas。
    *   实现 CRUD 路由逻辑。
3.  **前端开发**:
    *   配置 Tailwind 和 Shadcn UI。
    *   封装 API 请求层 (Axios/Fetch)。
    *   开发工单列表组件、添加/编辑组件。
    *   联调接口。
4.  **测试与优化**: 验证所有功能流程，优化交互体验。
